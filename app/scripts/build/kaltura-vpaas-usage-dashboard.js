!function(){var a;return a=angular.module("KalturaUsageDashboard.collections",[]),a.service("reportControlsSelectCollection",["Collection",function(a){return _.extend(this,new a),this.add([{id:-1,name:"Current month",dates:{low:function(){return new Date((new Date).setDate(1))},high:function(){return new Date}}},{id:0,name:"Last month",dates:{low:function(){return new Date((new Date).subMonth().setDate(1))},high:function(){return new Date((new Date).setDate(0))}}},{id:1,name:"Last 3 months","default":!0,dates:{low:function(){return new Date((new Date).subMonth(3).setDate(1))},high:function(){return new Date((new Date).setDate(0))}}},{id:2,name:"Custom date range by month",allowDatepickers:!0}]),this}])}(),function(){var a;return a=angular.module("KalturaUsageDashboard.config",[]),a.config(["$urlRouterProvider","$locationProvider","$httpProvider","RestangularProvider","kmcProvider",function(a,b,c,d,e){var f;return f=e.$get(),d.setBaseUrl(f.vars.service_url+"/api_v3/index.php"),a.when("/usage-dashboard","/usage-dashboard/overall-usage"),a.otherwise("/usage-dashboard")}])}(),function(){var a;return a=angular.module("KalturaUsageDashboard.constants",[]),a.service("constants",["ModuleConsolidator",function(b){return new b(a)}]),a.constant("dayms",864e5),a.constant("graph",{colorColumn:"#02a3d1",colorAxis:"#c2d2e1",colorText:"#585858",mainBg:"#f0eeef",borderWidth:7,labelRotation:{tiny:10,small:14,medium:19,large:26,full:32}}),a.constant("reports",{"overall-usage":{name:"Overall Usage report"},plays:{name:"Plays report"},storage:{name:"Average Storage report"},bandwidth:{name:"Bandwidth Consumption report"},"transcoding-consumption":{name:"Transcoding Consumption report"},"media-entries":{name:"Media Entries report"}}),a.constant("columns",{"default":[{title:"Month",field:"label"}],reports:{plays:[{title:"Plays (CPM)",field:"count_plays"}],storage:[{title:"Average Storage (GB)",field:"average_storage"}],bandwidth:[{title:"Bandwidth Consumption (GB)",field:"bandwidth_consumption"}],"transcoding-consumption":[{title:"Transcoding Consumption (GB)",field:"transcoding_consumption"}],"media-entries":[{title:"Total",field:"count_total"},{title:"Video",field:"count_video"},{title:"Audio",field:"count_audio"},{title:"Images",field:"count_image"}],"overall-usage":[{title:"Plays (CPM)",field:"count_plays"},{title:"Average Storage (GB)",field:"average_storage"},{title:"Transcoding Consumption (GB)",field:"transcoding_consumption"},{title:"Bandwidth Consumption (GB)",field:"bandwidth_consumption"},{title:"Media Entries",field:"count_total"},{title:"End Users",field:"end_users"}]}}),a.constant("ArrayPrototype",{byField:function(a,b){var c,d,e,f;for(d=e=0,f=this.length;f>e;d=++e)if(c=this[d],c[a]===b)return this[d]},each:function(a){var b,c,d,e,f;for(f=[],c=d=0,e=this.length;e>d;c=++d)b=this[c],f.push(a(b,c,this));return f},contains:function(a){var b,c,d,e;if(a)for(c=d=0,e=this.length;e>d;c=++d)if(b=this[c],null!=a.id&&b.id===a.id||this[c]===a||b.id===a)return!0;return!1},pushArray:function(a){var b,c,d;if(a&&a.length)for(c=0,d=a.length;d>c;c++)b=a[c],this.push(b);return this},replace:function(a,b){var c,d,e,f,g;for(g=[],d=e=0,f=this.length;f>e;d=++e)c=this[d],c===a&&g.push(this[d]=b);return g},remove:function(a){var b,c,d,e;for(c=d=0,e=this.length;e>d;c=++d)if(b=this[c],a===b){this.splice(c,1);break}return a},clear:function(){for(;this.length;)this.remove(this[0]);return this}}),a.constant("StringPrototype",{noSpaces:function(){return this.replace(/\s/g,"")},splice:function(a,b,c){return this.slice(0,a)+c+this.slice(a+Math.abs(b))},nMatches:function(a){var b;return b=new RegExp(a,"g"),(this.match(b)||[]).length},nPoints:function(){return this.nMatches("\\.")},contains:function(a){return this.indexOf(a)>=0}}),a.constant("NumberPrototype",{isFloat:function(){return this%1!==0}}),a.constant("NumberExtension",{round:function(a,b){var c;return null==b&&(b=0),c=Math.pow(10,b),Math.round(a*c)/c}}),a.service("DatePrototype",["$filter","dayms",function(a,b){return{fullzero:function(){return this.setYear(0),this.setMonth(0),this.setDate(1),this.zero()},zero:function(){return this.setHours(0,0,0,0),this},dateTimeZoneFix:function(){return new Date(this.setHours(this.getHours()+this.getTimezoneOffset()/60))},toMonthStart:function(){return this.setDate(1),this},toMonthEnd:function(){return this.setMonth(this.getMonth()+1),this.setDate(0),this},toYMD:function(){return a("date")(this,"yyyy-MM-dd")},toMDY:function(){return a("date")(this)},toYMDn:function(){return parseInt(this.toYMD().replace(/\-/g,""))},toYM:function(){return a("date")(this,"yyyy-MM")},toYMn:function(){return parseInt(this.toYM().replace(/\-/g,""))},subMonth:function(a){return null==a&&(a=1),this.setMonth(this.getMonth()-a),this},nDaysInMonth:function(){var a;return a=new Date(this),a.setMonth(a.getMonth()+1),a.setDate(0),a.getDate()},dg:function(a){var c,d;return c=this.valueOf()/b,d=new Date(a).valueOf()/b,c>d},ds:function(a){return new Date(a).dg(this)},dge:function(a){var c,d;return c=this.valueOf()/b,d=new Date(a).valueOf()/b,c>=d},dse:function(a){return new Date(a).dge(this)},de:function(a){var c,d;return c=this.valueOf()/b,d=new Date(a).valueOf()/b,c===d},dg_ms:function(a){var b,c;return b=this.valueOf(),c=new Date(a).valueOf(),b>c},ds_ms:function(a){var b,c;return b=this.valueOf(),c=new Date(a).valueOf(),c>b},dge_ms:function(a){var b,c;return b=this.valueOf(),c=new Date(a).valueOf(),b>=c},dse_ms:function(a){var b,c;return b=this.valueOf(),c=new Date(a).valueOf(),c>=b},dgNow:function(){return this.dg_ms(new Date)},dsNow:function(){return this.ds_ms(new Date)},de_ymd:function(a){var c,d,e,f;return c=new Date(this),d=new Date(a),e=c.setHours(0,0,0,0).valueOf()/b,f=d.setHours(0,0,0,0).valueOf()/b,e===f},tge:function(a){var b,c,d,e,f,g;return c=new Date(a),b=new Date(this),d=b.getHours(),e=c.getHours(),g=c.getMinutes(),f=b.getMinutes(),60*d+f>=60*e+g},te:function(a){var b,c,d,e,f,g;return b=new Date(this),c=new Date(a),d=b.getHours(),e=c.getHours(),f=b.getMinutes(),g=c.getMinutes(),d===e&&f===g},tse:function(a){var b,c,d,e,f,g,h,i;return b=new Date(this),c=new Date(a),d=b.getHours(),e=c.getHours(),f=b.getMinutes(),g=c.getMinutes(),h=b.getSeconds(),i=c.getSeconds(),d===e&&f===g&&h===i},isInMonth:function(a){return a=new Date(a),a.getFullYear()===this.getFullYear()&&a.getMonth()===this.getMonth()},isInPreviousMonth:function(a){return a=new Date(a),this.isInMonth(a.setMonth(a.getMonth()-1))},nMonths:function(){return 12*this.getFullYear()+this.getMonth()-11}}}]),a.constant("DateExtension",{fromYMDn:function(a){return new Date(Math.floor(a/1e4),Math.floor(a%1e4/100-1),a%100)},fromYMn:function(a){return new Date(Math.floor(a/100),a%100-1)},fromn:function(a){return Date[function(){switch((""+a).length){case 6:return"fromYMn";case 8:return"fromYMDn"}}()](a)},fromYMD:function(a){return new Date(a)},fromYM:function(a){return new Date(a+"-01")},nMonths:function(a,b){return new Date(b).nMonths()-new Date(a).nMonths()}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.directives.csv",["classy"]),a.directive("csv",function(){return{replace:!0,restrict:"A",templateUrl:"app/scripts/common/directives/csv/csv.html",controller:"CsvCtrl",scope:{filename:"@",name:"@csv",months:"="}}}),a.classy.controller({name:"CsvCtrl",inject:["constants","$filter","modals","constants"],init:function(){return this.output=this.$filter("output"),this.date=this.$filter("date")},getCsvArray:function(){var a,b;return a=this.$.months[0].dates[0],b=this.$.months[this.$.months.length-1].dates[this.$.months[this.$.months.length-1].dates.length-1],this.modals.confirm({message:"<div>You are going to download <b>"+this.constants.reports[this.$.name].name+"</b> in .csv format.</div>\n<div>Period: <b>"+this.date(a)+(a.toYMD()!==b.toYMD()?" - "+this.date(b):"")+"</b></div>\n<div>Proceed?</div>",title:"Export CSV"}).result.then(function(a){return function(){var b,c,d;return c=a.constants.columns.reports[a.$.name],[["Month","Year"].concat(function(){var a,d,e;for(e=[],a=0,d=c.length;d>a;a++)b=c[a],e.push(b.title);return e}())].concat(function(){var a,e,f,g;for(f=this.$.months,g=[],a=0,e=f.length;e>a;a++)d=f[a],g.push([this.date(d.dates[0],"MMMM"),this.date(d.dates[0],"yyyy")].concat(function(){var a,e,f;for(f=[],a=0,e=c.length;e>a;a++)b=c[a],f.push(this.output(d[b.field]));return f}.call(this)));return g}.call(a))}}(this))}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.directives.datepicker",["classy"]),a.directive("kalturaDatepicker",function(){return{restrict:"A",replace:!0,templateUrl:"app/scripts/common/directives/datepicker/datepicker.html",controller:"KalturaDatepickerCtrl",scope:{model:"=kalturaDatepicker",disabled:"=",min:"=?",max:"=?",name:"=?"}}}),a.classy.controller({name:"KalturaDatepickerCtrl",inject:["$element","$timeout"],init:function(){return this.input=this.$element.find("input"),this.$.options={changeYear:!0,changeMonth:!0,yearRange:"2000:-0"},this.$.name||(this.$.name="datepicker"),this.$timeout(function(a){return function(){return a._flushMin(),a._flushMax()}}(this))},watch:{min:function(a){return a?this._flushMin():void 0},max:function(a){return a?this._flushMax():void 0}},_flushMin:function(){return this.input.datepicker("option","minDate",this.$.min)},_flushMax:function(){return this.input.datepicker("option","maxDate",this.$.max)},open:function(){return this.input.datepicker("show"),null},hide:function(){return this.input.datepicker("hide"),null}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.directives.graph",["classy"]),a.directive("graph",function(){return{replace:!0,restrict:"A",templateUrl:"app/scripts/common/directives/graph/graph.html",controller:"GraphCtrl",scope:{data:"=graph",units:"@",yLabel:"@",valueField:"@",labelField:"@"}}}),a.classy.controller({name:"GraphCtrl",inject:["$filter"],injectToScope:["constants"],init:function(){return this.$.valueField||(this.$.valueField="value"),this.$.labelField||(this.$.labelField="label"),this.output=this.$filter("output")},watch:{data:function(a){return null==a||_.isEmpty(a)?this.$.graph=null:this._buildGraphData()}},_buildGraphData:function(){var a,b,c,d,e,f,g,h,i,j,k,l;for(a=[],l=[],c=0,e=0,i=this.$.data,b=0,d=i.length;d>b;b++)g=i[b],a.push([c,g[this.$.valueField]]),l.push([c,g[this.$.labelField]]),e<g[this.$.valueField]&&(e=g[this.$.valueField]),c++;for(j=parseInt(e).toString(),h=Math.pow(10,j.length-1||1),k=h/2,f=parseInt(j[0])*h||10,e>f&&(f+=h);10>=f/k&&k/2===Math.floor(k/2);)k/=2;return this.$.graph={data:[{color:this.constants.graph.colorColumn,data:a}],options:{series:{bars:{show:!0,lineWidth:0,fill:!0,fillColor:this.constants.graph.colorColumn}},tooltip:{show:!0,content:function(a){return function(b,c,d,e){return"<div class='text'>"+e.series.xaxis.ticks[e.dataIndex].label+"</div>\n<div class='value'>"+a.output(e.series.data[e.dataIndex][1])+" "+(a.$.units||"")+"</div>"}}(this),cssClass:"graph-tooltip"},bars:{align:"center",barWidth:.75},xaxis:{show:!0,color:this.constants.graph.colorAxis,ticks:l,tickLength:0,min:-.5,max:a.length-.5},yaxis:{show:!0,axisLabel:(this.$.yLabel||"")+" "+(this.$.units||""),color:this.constants.graph.colorAxis,axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"arial,sans serif",axisLabelPadding:10,axisLabelColour:this.constants.graph.colorText,reserveSpace:!0,tickLength:15,tickSize:k,max:f,tickFormatter:function(a){return function(b){return"<p>"+(b%(2*k)?"":a.output(b))+"</p>"}}(this)},legend:{noColumns:0,labelBoxBorderColor:"#000000",position:"nw"},grid:{show:!0,hoverable:!0,clickable:!0,borderWidth:{top:0,right:0,bottom:this.constants.graph.borderWidth,left:this.constants.graph.borderWidth},borderColor:this.constants.graph.colorAxis,backgroundColor:this.constants.graph.mainBg,aboveData:!1,axisMargin:10}}}}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.directives.header",["classy"]),a.directive("header",function(){return{replace:!0,restrict:"A",templateUrl:"app/scripts/common/directives/header/header.html",controller:"HeaderCtrl"}}),a.classy.controller({name:"HeaderCtrl",inject:["kmc"],injectToScope:["go"],init:function(){return this.$.items=this.go.state().substates,this.$.helpHref=this.kmc.vars.service_url+"/content/docs/NetHelp/default.htm#!Documents/contentreports.htm"}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.directives.html-bind-compile",[]),a.directive("htmlBindCompile",["$compile",function(a){return{restrict:"A",link:function(b,c,d){return b.$watch(d.htmlBindCompile,function(d,e){return c.html(d),a(c.contents())(b)})}}}])}(),function(){var a;return a=angular.module("KalturaUsageDashboard.directives.modal",["classy"]),a.directive("modal",function(){return{replace:!0,restrict:"A",templateUrl:"app/scripts/common/directives/modal/modal.html",transclude:!0,scope:{title:"=",okText:"=",cancelText:"="}}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.directives.monthly-breakdown",["classy"]),a.directive("monthlyBreakdown",function(){return{replace:!0,restrict:"A",templateUrl:"app/scripts/common/directives/monthly-breakdown/monthly-breakdown.html",controller:"MonthlyBreakdownCtrl",scope:{name:"@monthlyBreakdown",months:"=",cls:"@"}}}),a.classy.controller({name:"MonthlyBreakdownCtrl",inject:["constants"],init:function(){return this._determineColumns()},_determineColumns:function(){return this.$.columns=this.constants.columns["default"].concat(this.constants.columns.reports[this.$.name])}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.directives.overlay",[]),a.directive("overlay",function(){return{replace:!0,restrict:"A",templateUrl:"app/scripts/common/directives/overlay/overlay.html",scope:{show:"&overlay"},link:function(a,b){return b.parent().addClass("overlay-parent")}}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.directives.report-controls",["classy"]),a.directive("reportControls",function(){return{replace:!0,restrict:"A",templateUrl:"app/scripts/common/directives/report-controls/report-controls.html",controller:"ReportControlsCtrl",scope:{from:"=?",to:"=?",changed:"&",disabled:"="}}}),a.classy.controller({name:"ReportControlsCtrl",inject:["$timeout"],injectToScope:["reportControlsSelectCollection","go"],init:function(){return this._initParams()},watch:{"select.model":function(a,b){return a!==b&&null!=a?(this._calcRange(),this._changed()):void 0},"dates.low":function(a,b){return a!==b&&null!=a?(this._calcFrom(),this._changed()):void 0},"dates.high":function(a,b){return a!==b&&null!=a?(this._calcTo(),this._changed()):void 0}},_initParams:function(){return this.$.select={data:this.reportControlsSelectCollection.arr,options:{allowClear:!1,placeholder:"Select period...",minimumResultsForSearch:-1},model:this.reportControlsSelectCollection.singleWhere({"default":!0}).id},this.$.dates={low:new Date,high:new Date},this._calcRange(),this._changed()},_changed:function(){return this.$timeout(function(a){return function(){var b;return"function"==typeof(b=a.$).changed?b.changed():void 0}}(this))},_calcRange:function(){return this.$.range=this.reportControlsSelectCollection.by(this.$.select.model),this._calcFrom(),this._calcTo()},_calcFrom:function(){return this.$.from=this.$.range.allowDatepickers?this.$.dates.low:this.$.range.dates.low()},_calcTo:function(){return this.$.to=this.$.range.allowDatepickers?this.$.dates.high:this.$.range.dates.high()}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.directives.side-menu",["classy"]),a.directive("sideMenu",function(){return{replace:!0,restrict:"A",templateUrl:"app/scripts/common/directives/side-menu/side-menu.html",controller:"SideMenuCtrl"}}),a.classy.controller({name:"SideMenuCtrl",injectToScope:["go"],init:function(){return this.go.state(),this.$.menuItems=this.go.state("usage-dashboard").substates}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.directives.spinner",["classy"]),a.directive("spinner",function(){return{replace:!0,restrict:"A",templateUrl:"app/scripts/common/directives/spinner/spinner.html",controller:"SpinnerCtrl",scope:!0}}),a.classy.controller({name:"SpinnerCtrl",injectToScope:["go"]})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.factories.module-consolidator",[]),a.factory("ModuleConsolidator",function(){return function(a,b,c){var d,e,f,g,h,i,j;for(null==b&&(b=""),null==c&&(c=_.last(a.name.split("."))),d={},g=angular.injector(["ng","KalturaUsageDashboard",["$provide",function(a){return void a.value("$rootElement",angular.element(window.document))}]]),j=a._invokeQueue,f=0,h=j.length;h>f;f++)e=j[f],i=e[2][0],i!==c&&(d[i.replace(b,"")]=g.get(i));return d}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.factories.rest",[]),a.factory("RestFactory",["Restangular","Collection","x2js","go","kmc","utils","$filter","errorsHandler",function(a,b,c,d,e,f,g,h){return function(i){return _.extend(i,{dontCollect:!0,params:angular.copy(_.extend(i.params||{},{ks:e.vars.ks,service:"report","reportInputFilter:timeZoneOffset":(new Date).getTimezoneOffset(),"reportInputFilter:objectType":"KalturaReportInputFilter"}))}),_.extend(this,new b(a.one(""),i),{modifiers:function(a){return _.isArray(a)||(a=[a]),_.extend(this,{extract:{dict:function(a){var b,c;return b=a.header.split(","),c=a.data.split(","),_.zipObject(b,c)},graph:function(a){var b,c;return b=_.pluck(a.item,"id"),c=_.pluck(a.item,"data").map(function(a){var b,c,d,e,f,g;for(f=a.split(";"),g=[],c=0,d=f.length;d>c;c++)b=f[c],b.length&&(e=b.split(","),g.push({date:Date.fromn(parseInt(e[0])),value:e[1]}));return g}),_.zipObject(b,c)},months:function(b){return function(c,d){var e,h,i,j,k,l,m,n,o,p,q,r,s,t,u;for(r=b.extract.graph(c),s={},j=0,m=a.length;m>j;j++)h=a[j],s[h]=f.arrToObjByFn(r[h]||[],function(a){return a.date.toYMD()});for(q={},i=d["reportInputFilter:fromDay"],u=d["reportInputFilter:toDay"],e=Date.fromYMDn(i);e.toYMDn()<=u;){if(p=e.toYM(),null==q[p])for(q[p]={label:g("date")(e,"MMMM, yyyy"),dates:[]},k=0,n=a.length;n>k;k++)h=a[k],q[p][h]=0;for(q[p].dates.push(new Date(e)),l=0,o=a.length;o>l;l++)h=a[l],q[p][h]+=parseFloat((null!=(t=s[h][e.toYMD()])?t.value:void 0)||0);e.setDate(e.getDate()+1)}return b.convert.monthsLabels(f.objToArr(q),{from:Date.fromYMDn(i),to:Date.fromYMDn(u)})}}(this)},convert:{MBtoGB:function(b){var c,d,e,f,g,h;for(d=0,f=b.length;f>d;d++)for(h=b[d],e=0,g=a.length;g>e;e++)c=a[e],h[c]/=1024;return b},monthsLabels:function(a,b){var c,d,e,f,g,h,i;for(d=0,f=a.length;f>d;d++)g=a[d],h=new Date(g.dates[0]),g.dates.length===h.nDaysInMonth()||(i=h.toYMn())!==b.from.toYMn()&&i!==b.to.toYMn()||(c=h.getDate(),e=g.dates[g.dates.length-1].getDate(),g.label=""+c+(c!==e?"-"+e:"")+" "+g.label);return a}}})}}),this.addFetchInterceptor(function(a){return c.xml_str2json(a).xml.result}),this.addFetchInterceptor(function(a){return function(b,c){return null!=b.error?(a.cancelAllRequests(b),{}):b}}(this)),this.extendFetch({b:function(){return d.inc()},f:function(){return d.dec()},e:h}),this}}])}(),function(){var a;return a=angular.module("KalturaUsageDashboard.filters",[]),a.filter("output",["$filter",function(a){var b;return b=a("number"),function(a,c){switch(null==c&&(c=2),!0){case _.isNumber(a):return a.isFloat()?b(a,c):b(a,0);default:return a}}}])}(),function(){var a;return a=angular.module("KalturaUsageDashboard.head",["classy"]),a.classy.controller({name:"HeadCtrl",injectToScope:["go"]})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.kmc-config",[]),a.provider("kmc",function(){return{$get:function(){var a,b,c,d,e,f,g,h;for(b="MTE3MmMwYjkwOTUzYTRkMDc1MzMwMmZhNjAzZWUxMmI2Y2M5ZmY5ZHw5MzkzNDE7OTM5MzQxOzE0NDYxMzMzOTk7MjsxNDQ2MDQ2OTk5LjYzNDI7cmtzaGFyZWRib3hAZ21haWwuY29tO2Rpc2FibGVlbnRpdGxlbWVudDs7",h=(null!=(f=location.search||location.hash)&&null!=(g=f.split("?")[1])?g.split("&"):void 0)||[],a=0,c=h.length;c>a;a++)if(d=h[a],e=d.split("="),"ks"===e[0]){b=e[1];break}return window.kmc||{vars:{service_url:"http://www.kaltura.com",ks:b}}}}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.rest",["KalturaUsageDashboard.rest.plays-report","KalturaUsageDashboard.rest.bandwidth-report","KalturaUsageDashboard.rest.storage-report","KalturaUsageDashboard.rest.transcoding-consumption-report","KalturaUsageDashboard.rest.media-entries-report"])}(),function(){var a;return a=angular.module("KalturaUsageDashboard.rest.bandwidth-report",[]),a.service("bandwidthReport",["RestFactory",function(a){var b;return _.extend(this,new a({params:{action:"getGraphs",reportType:201,"reportInputFilter:interval":"days"}})),b=this.modifiers("bandwidth_consumption"),this.addFetchInterceptor(b.extract.months),this.addFetchInterceptor(b.convert.MBtoGB),this}])}(),function(){var a;return a=angular.module("KalturaUsageDashboard.rest.media-entries-report",[]),a.service("mediaEntriesReport",["RestFactory",function(a){return _.extend(this,new a({params:{action:"getGraphs",reportType:5,"reportInputFilter:interval":"days"}})),this.addFetchInterceptor(this.modifiers(["count_total","count_video","count_audio","count_image"]).extract.months),this}])}(),function(){var a;return a=angular.module("KalturaUsageDashboard.rest.plays-report",[]),a.service("playsReport",["playsReport.playsNumber","playsReport.mediaEntriesNumber","playsReport.graphData",function(a,b,c){return{playsNumber:a,mediaEntriesNumber:b,graphData:c}}]),a.service("playsReport.playsNumber",["RestFactory",function(a){return _.extend(this,new a({params:{action:"getTotal",reportType:1}})),this.addFetchInterceptor(function(a){return function(b){return parseInt(a.modifiers().extract.dict(b).count_plays||0)}}(this)),this}]),a.service("playsReport.mediaEntriesNumber",["RestFactory",function(a){return _.extend(this,new a({params:{action:"getTable",reportType:1,"pager:objectType":"KalturaFilterPager","pager:pageIndex":1,"pager:pageSize":1}})),this.addFetchInterceptor(function(a){return function(a){return parseInt(a.totalCount||0)}}(this)),this}]),a.service("playsReport.graphData",["RestFactory",function(a){return _.extend(this,new a({params:{action:"getGraphs",reportType:1,"reportInputFilter:interval":"days"}})),this.addFetchInterceptor(this.modifiers("count_plays").extract.months),this}])}(),function(){var a;return a=angular.module("KalturaUsageDashboard.rest.storage-report",[]),a.service("storageReport",["RestFactory",function(a){var b;return _.extend(this,new a({params:{action:"getGraphs",reportType:201,"reportInputFilter:interval":"days"}})),b=this.modifiers("average_storage"),this.addFetchInterceptor(b.extract.months),this.addFetchInterceptor(b.convert.MBtoGB),this}])}(),function(){var a;return a=angular.module("KalturaUsageDashboard.rest.transcoding-consumption-report",[]),a.service("transcodingConsumptionReport",["RestFactory",function(a){var b;return _.extend(this,new a({params:{action:"getGraphs",reportType:201,"reportInputFilter:interval":"days"}})),b=this.modifiers("transcoding_consumption"),this.addFetchInterceptor(b.extract.months),this.addFetchInterceptor(b.convert.MBtoGB),this}])}(),function(){var a;return a=angular.module("KalturaUsageDashboard.run",[]),a.run(["ArrayPrototype","StringPrototype","NumberPrototype","NumberExtension","DatePrototype","DateExtension",function(a,b,c,d,e,f){return _.extend(Array.prototype,a),_.extend(String.prototype,b),_.extend(Number.prototype,c),_.extend(Number,d),_.extend(Date.prototype,e),_.extend(Date,f)}]),a.run(["$window","utils",function(a,b){return a.isMobileOrTablet=b.navigator.isMobileOrTablet(),a.isMobile=b.navigator.isMobile()}])}(),function(){var a;return a=angular.module("KalturaUsageDashboard.services.errors-handler",[]),a.service("errorsHandler",["modals",function(a){return function(b){var c;return c=function(){var a;if(null==(null!=b&&null!=(a=b.error)?a.code:void 0))return"Unable to load the requested information";switch(b.error.code){case"INVALID_KS":return"Your session has expired. Please refresh the page to continue.";default:return b.error.message}}(),a.error({message:c})}}])}(),function(){var a;return a=angular.module("KalturaUsageDashboard.services.go",[]),a.service("go",["$state",function(a){return _.extend(this,{current:function(){return _.extend({},a.current,a.current)},go:function(){return a.go.apply(a,arguments)},$state:a,state:function(b){return function(c){var d;return _.extend(a.get(c)||{},{substates:function(){var b,e,f,g;for(f=a.get(),g=[],b=0,e=f.length;e>b;b++)d=f[b],d.name.contains(c||"")&&d.name.length&&d.name.nPoints()===(null!=c?c.nPoints()+1:0)&&g.push(this.state(d.name));return g}.call(b)||[]})}}(this),flags:{loading:0},inc:function(a){return function(b){return null==b&&(b=1),a.flags.loading+=b}}(this),dec:function(a){return function(b){return null==b&&(b=1),a.flags.loading-=b}}(this),isLoading:function(a){return function(){var b,c,d;c=a.flags;for(b in c)if(d=c[b],d>0)return!0;return!1}}(this)})}])}(),function(){var a;return a=angular.module("KalturaUsageDashboard.services.modals",["classy"]),a.service("modals",["$uibModal",function(a){return _.extend(this,{info:function(b){return a.open({templateUrl:"app/scripts/common/modals/info-modal.html",controller:"ModalCtrl",resolve:{data:function(){return b}}})},confirm:function(a){return function(b){return null==b.title&&(b.title="Confirmation"),b.okText||(b.okText="OK"),b.cancelText||(b.cancelText="Cancel"),b.type="confirm",a.info(b)}}(this),error:function(a){return null==a.title&&(a.title="Error"),a.cancelText||(a.okText="OK"),a.type="error",this.info(a)}})}]),a.classy.controller({name:"ModalCtrl",injectToScope:["data"]})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.utils",[]),a.service("utils",function(){return{arrToObjByFn:function(a,b){var c,d,e,f;for(f={},d=0,e=a.length;e>d;d++)c=a[d],f[b(c)]=c;return f},arrToObjByField:function(a,b){var c,d,e,f;for(f={},d=0,e=a.length;e>d;d++)c=a[d],f[c[b]]=c;return f},arrToObjOfArrByField:function(a,b){var c,d,e,f;for(f={},d=0,e=a.length;e>d;d++)c=a[d],null==f[c[b]]&&(f[c[b]]=[]),f[c[b]].push(c);return f},arrToObj:function(a){var b,c,d,e;for(e={},c=0,d=a.length;d>c;c++)b=a[c],e[b]=b;return e},objToArr:function(a){var b,c,d;if(_.isArray(a))return a;b=[];for(c in a)d=a[c],b.push(d);return b},parity:function(a){return a%2?"odd":"even"},navigator:{isMobileOrTablet:function(){var a;return a=!1,function(b){return a=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),a},isMobile:function(){var a;return window.mobilecheck=function(){},a=!1,function(b){return a=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),a}},reports:{extractPayload:function(a){return{"reportInputFilter:fromDay":a.from.toYMDn(),"reportInputFilter:toDay":a.to.toYMDn()}}}}}),a.service("tryApply",["$rootScope",function(a){return function(b){return a.$$phase?b():a.$apply(b)}}])}(),function(){var a;return a=angular.module("KalturaUsageDashboard.usage-dashboard.bandwidth-report",["classy"]),a.config(["$stateProvider",function(a){return a.state("usage-dashboard.bandwidth",{url:"/bandwidth",views:{main:{controller:"BandwidthReportCtrl",templateUrl:"app/scripts/pages/usage-dashboard/bandwidth-report/bandwidth-report.html"}},data:{pageTitle:"Bandwidth Report"}})}]),a.classy.controller({name:"BandwidthReportCtrl",inject:["bandwidthReport","utils","$filter"],fetch:function(){return this._extractPayload(),this._fetchData()},_extractPayload:function(){return this.payload=this.utils.reports.extractPayload(this.$.dates)},_fetchData:function(){return this.$.months=null,this.bandwidthReport.fetch(this.payload).then(function(a){return function(b){return a.$.months=_.extend(b,{dates:a.$.dates})}}(this),function(a){return function(a){return console.log(a)}}(this))}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.usage-dashboard.media-entries-report",["classy"]),a.config(["$stateProvider",function(a){return a.state("usage-dashboard.media-entries",{url:"/media-entries",views:{main:{controller:"MediaEntriesReportCtrl",templateUrl:"app/scripts/pages/usage-dashboard/media-entries-report/media-entries-report.html"}},data:{pageTitle:"Media Entries Report"}})}]),
a.classy.controller({name:"MediaEntriesReportCtrl",inject:["mediaEntriesReport","utils","$filter"],fetch:function(){return this._extractPayload(),this._fetchData()},_extractPayload:function(){return this.payload=this.utils.reports.extractPayload(this.$.dates)},_fetchData:function(){return this.$.months=null,this.mediaEntriesReport.fetch(this.payload).then(function(a){return function(b){return a.$.months=_.extend(b,{dates:a.$.dates})}}(this))}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.usage-dashboard.overall-usage-report",["classy"]),a.config(["$stateProvider",function(a){return a.state("usage-dashboard.overall-usage",{url:"/overall-usage",views:{main:{controller:"OverallUsageReportCtrl",templateUrl:"app/scripts/pages/usage-dashboard/overall-usage-report/overall-usage-report.html"}},data:{pageTitle:"Overall Usage Report"}})}]),a.classy.controller({name:"OverallUsageReportCtrl",inject:["playsReport","storageReport","bandwidthReport","transcodingConsumptionReport","mediaEntriesReport","utils","$q"],injectToScope:["go"],init:function(){return this._fetchCurrentMonth(),this._fetchLastThreeMonths()},_fetchCurrentMonth:function(){return this.__fetch({from:(new Date).toMonthStart(),to:new Date}).then(function(a){return function(b){return a.$.currentMonth=b[0]}}(this))},_fetchLastThreeMonths:function(){return this.__fetch({from:(new Date).subMonth(2).toMonthStart(),to:new Date}).then(function(a){return function(b){return a.$.lastThreeMonths=b}}(this))},__fetch:function(a){var b;return b=this.utils.reports.extractPayload(a),this.$q.all([this.playsReport.graphData.fetch(b),this.storageReport.fetch(b),this.bandwidthReport.fetch(b),this.transcodingConsumptionReport.fetch(b),this.mediaEntriesReport.fetch(b)]).then(function(b){return function(b){var c,d,e,f,g,h,i,j;for(j=[],c=d=0,g=Date.nMonths(a.from,a.to);g>=0?g>=d:d>=g;c=g>=0?++d:--d){for(i={},e=0,f=b.length;f>e;e++)h=b[e],_.extend(i,h[c]);j.push(i)}return j}}(this))},__fetchPlays:function(a){return this.playsReport.graphData.fetch(a).then(function(a){return function(a){return{plays:a}}}(this))},__fetchStorage:function(a){return this.storageReport.fetch(a).then(function(a){return function(a){return{storage:a}}}(this))},__fetchBandwidth:function(a){return this.bandwidthReport.fetch(a).then(function(a){return function(a){return{bandwidth:a}}}(this))},__fetchTranscodingConsumption:function(a){return this.transcodingConsumptionReport.fetch(a).then(function(a){return function(a){return{transcoding:a}}}(this))},__fetchMediaEntries:function(a){return this.mediaEntriesReport.fetch(a).then(function(a){return function(a){return{media:a}}}(this))}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.usage-dashboard.plays-report",["classy"]),a.config(["$stateProvider",function(a){return a.state("usage-dashboard.plays",{url:"/plays",views:{main:{controller:"PlaysReportCtrl",templateUrl:"app/scripts/pages/usage-dashboard/plays-report/plays-report.html"}},data:{pageTitle:"Plays Report"}})}]),a.classy.controller({name:"PlaysReportCtrl",inject:["playsReport","utils"],fetch:function(){return this._extractPayload(),this._fetchPlaysNumber(),this._fetchMediaEntriesNumber(),this._fetchData()},_extractPayload:function(){return this.payload=this.utils.reports.extractPayload(this.$.dates)},_fetchPlaysNumber:function(){return this.playsReport.playsNumber.fetch(this.payload).then(function(a){return function(b){return a.$.playsNumber=b}}(this))},_fetchMediaEntriesNumber:function(){return this.playsReport.mediaEntriesNumber.fetch(this.payload).then(function(a){return function(b){return a.$.mediaEntriesNumber=b}}(this))},_fetchData:function(){return this.$.months=null,this.playsReport.graphData.fetch(this.payload).then(function(a){return function(b){return a.$.months=_.extend(b,{dates:a.$.dates})}}(this))}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.usage-dashboard.storage-report",["classy"]),a.config(["$stateProvider",function(a){return a.state("usage-dashboard.storage",{url:"/storage",views:{main:{controller:"StorageReportCtrl",templateUrl:"app/scripts/pages/usage-dashboard/storage-report/storage-report.html"}},data:{pageTitle:"Storage Report"}})}]),a.classy.controller({name:"StorageReportCtrl",inject:["storageReport","utils","$filter"],fetch:function(){return this._extractPayload(),this._fetchData()},_extractPayload:function(){return this.payload=this.utils.reports.extractPayload(this.$.dates)},_fetchData:function(){return this.$.months=null,this.storageReport.fetch(this.payload).then(function(a){return function(b){return a.$.months=_.extend(b,{dates:a.$.dates})}}(this))}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.usage-dashboard.transcoding-consumption-report",["classy"]),a.config(["$stateProvider",function(a){return a.state("usage-dashboard.transcoding-consumption",{url:"/transcoding-consumption",views:{main:{controller:"TranscodingConsumptionReportCtrl",templateUrl:"app/scripts/pages/usage-dashboard/transcoding-consumption-report/transcoding-consumption-report.html"}},data:{pageTitle:"Transcoding Consumption Report"}})}]),a.classy.controller({name:"TranscodingConsumptionReportCtrl",inject:["transcodingConsumptionReport","utils","$filter"],fetch:function(){return this._extractPayload(),this._fetchData()},_extractPayload:function(){return this.payload=this.utils.reports.extractPayload(this.$.dates)},_fetchData:function(){return this.$.months=null,this.transcodingConsumptionReport.fetch(this.payload).then(function(a){return function(b){return a.$.months=_.extend(b,{dates:a.$.dates})}}(this))}})}(),function(){var a;return a=angular.module("KalturaUsageDashboard.usage-dashboard",["classy","KalturaUsageDashboard.usage-dashboard.overall-usage-report","KalturaUsageDashboard.usage-dashboard.plays-report","KalturaUsageDashboard.usage-dashboard.storage-report","KalturaUsageDashboard.usage-dashboard.bandwidth-report","KalturaUsageDashboard.usage-dashboard.transcoding-consumption-report","KalturaUsageDashboard.usage-dashboard.media-entries-report"]),a.config(["$stateProvider","$urlRouterProvider",function(a,b){return a.state("usage-dashboard",{url:"/usage-dashboard",views:{main:{controller:"UsageDashboardCtrl",templateUrl:"app/scripts/pages/usage-dashboard/usage-dashboard.html"}},data:{pageTitle:"Account Usage Reports"}})}]),a.classy.controller({name:"UsageDashboardCtrl"})}(),function(){var a;return a=angular.module("KalturaUsageDashboard",["angular-flot","rt.select2","ui.date","ui.bootstrap","ui.router","restangular","classy","cb.x2js","ng-bundle-collection","angular-spinkit","ngSanitize","ngCsv","KalturaUsageDashboard.kmc-config","KalturaUsageDashboard.config","KalturaUsageDashboard.constants","KalturaUsageDashboard.run","KalturaUsageDashboard.filters","KalturaUsageDashboard.utils","KalturaUsageDashboard.rest","KalturaUsageDashboard.collections","KalturaUsageDashboard.head","KalturaUsageDashboard.services.modals","KalturaUsageDashboard.directives.header","KalturaUsageDashboard.directives.side-menu","KalturaUsageDashboard.directives.datepicker","KalturaUsageDashboard.directives.graph","KalturaUsageDashboard.directives.report-controls","KalturaUsageDashboard.directives.spinner","KalturaUsageDashboard.directives.csv","KalturaUsageDashboard.directives.overlay","KalturaUsageDashboard.directives.monthly-breakdown","KalturaUsageDashboard.directives.modal","KalturaUsageDashboard.directives.html-bind-compile","KalturaUsageDashboard.services.go","KalturaUsageDashboard.services.errors-handler","KalturaUsageDashboard.factories.rest","KalturaUsageDashboard.factories.module-consolidator","KalturaUsageDashboard.usage-dashboard"])}();